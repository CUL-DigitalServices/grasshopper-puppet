# keep in sync with https://github.com/ucamrc/grasshopper-ui/blame/master/apps/admin/apache/app.conf
<VirtualHost *:80>


    # ----------------------------------------------------------------------
    # General Host Settings
    # ----------------------------------------------------------------------

# TODO parameterise this and put something useful in esp as it becomes public
#    ServerAdmin admin@grasshopper.com
    DocumentRoot /opt/grasshopper-ui/apps/admin/ui
    ServerName <%= @admin_servername %>

    ErrorLog /var/log/apache2/logsadmin_error.log
    CustomLog /var/log/apache2/logsadmin_custom.log common


    # ----------------------------------------------------------------------
    # ProxyPass Directives
    # ----------------------------------------------------------------------

    #Â Proxy api calls to the application server
    ProxyPass /api http://localhost:2000/api retry=0
    ProxyPassReverse /api http://localhost:2000/api
    ProxyPreserveHost On


    # ----------------------------------------------------------------------
    # General Directives
    # ----------------------------------------------------------------------

    # Shared files
    Alias /shared /opt/grasshopper-ui/shared

    # API docs
    Alias /docs /opt/grasshopper-ui/docs

    # App files
    Alias /apps /opt/grasshopper-ui/apps

    # Configuration
    Alias /configuration /opt/grasshopper-ui/apps/admin/ui

    # Tenants
    Alias /tenants /opt/grasshopper-ui/apps/admin/ui

    # Users
    Alias /users /opt/grasshopper-ui/apps/admin/ui

    # QUnit tests
    Alias /qunit /opt/grasshopper-ui/tests/qunit
    <Directory /opt/grasshopper-ui/tests/qunit>
        Options Indexes FollowSymLinks
        Order Allow,Deny
        Allow from All

        RewriteEngine On
        RewriteBase /qunit
        RewriteRule ^api\.(.*)$ /opt/grasshopper-ui/tests/qunit/tests/api.$1.html
    </Directory>

    RewriteEngine On
    RewriteRule ^/notfound$     <%= apacheConf.admin.shared %>/gh/errors/404.html
    RewriteRule ^/unavailable$  <%= apacheConf.admin.shared %>/gh/errors/503.html


    # ----------------------------------------------------------------------
    # Error Documents
    # ----------------------------------------------------------------------

    ErrorDocument 401 /shared/gh/errors/401.html
    ErrorDocument 404 /shared/gh/errors/404.html
    ErrorDocument 503 /shared/gh/errors/503.html

    <Directory />
        AuthType basic
        AuthName "Grasshopper Dev Server"
# FIXME work out where best to put this file
        AuthUserFile /opt/dev_auth_file
        Require valid-user
    </Directory>

</VirtualHost>
