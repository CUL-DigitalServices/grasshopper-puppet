# TODO sync with grasshopper-ui/blame/master/apps/timetable/apache/app.conf

# TODO probably want this block back in production? (but in a separate file/ in the main apache2.conf), but for now allow random hosts to facilitate tenant testing
#<VirtualHost *:80>
# First VirtualHost block is default, catch random people browsing with wrong ServerName
#    <Directory />
#        Order Allow,Deny
#        Deny from All
#    </Directory>
#
#</VirtualHost>

<VirtualHost *:80>
    ServerAdmin admin@grasshopper.com
    DocumentRoot /opt/grasshopper-ui/apps/timetable/ui
# Deliberately omit ServerName for now to allow tenant testing
#    ServerName thingy.grasshopper.doodah
    ErrorLog /var/log/apache2/logstimetable_error.log
    CustomLog /var/log/apache2/logstimetable_custom.log common

    #Â Proxy api calls to the application server
    ProxyPass /api http://localhost:2001/api retry=0
    ProxyPassReverse /api http://localhost:2001/api
    ProxyPreserveHost On

    # Shared files
    Alias /shared /opt/grasshopper-ui/shared

    # App files
    Alias /apps /opt/grasshopper-ui/apps

    # QUnit tests
    Alias /qunit /opt/grasshopper-ui/tests/qunit
    <Directory /opt/grasshopper-ui/tests/qunit>
        Options Indexes FollowSymLinks
        Order Allow,Deny
        Allow from All

        RewriteEngine On
        RewriteBase /qunit
        RewriteRule ^api\.(.*)$ /opt/grasshopper-ui/tests/qunit/tests/api.$1.html
    </Directory>

    <Directory />
# RETHINK THIS? this is for externally visible servers so that timetable data not mistaken for real - this is even before login (even with Shib)
        AuthType basic
        AuthName "Grasshopper Dev Server"
        AuthUserFile /etc/apache2/dev_auth_file
        Require valid-user
    </Directory>

</VirtualHost>
